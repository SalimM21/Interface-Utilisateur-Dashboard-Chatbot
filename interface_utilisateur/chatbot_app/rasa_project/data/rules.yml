version: "3.1"

rules:

  # -----------------------------
  # Fallback global (réponse quand le bot ne comprend pas)
  - rule: Fallback global
    steps:
      - intent: nlu_fallback
      - action: utter_default
      - action: action_listen

  # -----------------------------
  # Interruption: l'utilisateur veut arrêter la conversation
  - rule: Cancel conversation
    steps:
      - intent: au_revoir
      - action: utter_goodbye
      - action: action_listen

  - rule: Cancel conversation (EN)
    steps:
      - intent: goodbye
      - action: utter_goodbye
      - action: action_listen

  # -----------------------------
  # Interruption: l'utilisateur remercie le bot
  - rule: Thank you
    steps:
      - intent: merci
      - action: utter_you_are_welcome
      - action: action_listen

  - rule: Thank you (EN)
    steps:
      - intent: thanks
      - action: utter_you_are_welcome
      - action: action_listen

  # -----------------------------
  # Interruption: l'utilisateur change d'intention (ex: passe du score aux alertes)
  - rule: Changement d'intention
    condition:
      - active_loop: null
    steps:
      - intent: demander_score
      - action: action_get_score
      - action: utter_score_response

  - rule: Change intent (EN)
    condition:
      - active_loop: null
    steps:
      - intent: ask_score
      - action: action_get_score
      - action: utter_score_response
